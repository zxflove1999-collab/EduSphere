
该系统包含两个主要子模块：**宿舍模块** 和 **交流平台模块**。

-----

## 校园生活系统 (Campus Life System)

## 1\. 宿舍管理 (Admin)

(此模块对应 `t_dorm_building`, `t_dorm_room`, `t_bed`, `t_student_dorm`，实现管理员对宿舍信息的设置和管理)

### 1.1 宿舍楼列表查询

#### 1.1.1 基本信息

  * **请求路径：** `/admin/dorm/buildings`
  * **请求方式：** `GET`
  * **接口描述：** 管理员查询宿舍楼列表。

#### 1.1.2 请求参数

  * **格式：** `queryString`
  * **参数说明：**

| 参数名 | 类型 | 是否必填 | 备注 |
| :--- | :--- | :--- | :--- |
| `page` | Integer | 否 | 页码 (默认 1) |
| `gender_limit` | Integer | 否 | 按性别限制筛选 (1:男, 2:女, 0:不限) |
| `is_active` | Integer | 否 | 按状态筛选 (1:启用, 0:停用) |

### 1.2 设置宿舍楼状态 (管理员)

#### 1.2.1 基本信息

  * **请求路径：** `/admin/dorm/buildings/{building_id}/status`
  * **请求方式：** `PUT`
  * **接口描述：** 对应管理员“宿舍状态设置”，用于启用/停用宿舍楼。

#### 1.2.2 请求参数

  * **格式：** 路径参数 + `application/json`
  * **参数说明：**

| 参数名 | 类型 | 是否必填 | 备注 |
| :--- | :--- | :--- | :--- |
| `building_id` | Integer | 是 | (路径参数) 宿舍楼ID |
| `is_active` | Integer | 是 | 新状态 (1:启用, 0:停用/维修) |
| `reason` | String | 否 | 状态变更原因 (如果设置为0) |

### 1.3 宿舍房间列表查询

#### 1.3.1 基本信息

  * **请求路径：** `/admin/dorm/rooms`
  * **请求方式：** `GET`
  * **接口描述：** 对应管理员“宿舍状态设置”和“宿舍管理”，查询房间列表。

#### 1.3.2 请求参数

  * **格式：** `queryString`
  * **参数说明：**

| 参数名 | 类型 | 是否必填 | 备注 |
| :--- | :--- | :--- | :--- |
| `page` | Integer | 否 | 页码 (默认 1) |
| `building_id` | Integer | 否 | 按所属宿舍楼筛选 |
| `room_number` | String | 否 | 按房间编号模糊查询 |
| `occupancy_status` | Integer | 否 | 按入住状态筛选 (1:空闲, 2:部分入住, 3:住满) |

#### 1.3.3 响应数据

  * **参数格式：** `application/json`
  * **响应数据样例：**

<!-- end list -->

```json
{
  "code": 1,
  "msg": "success",
  "data": {
    "rows": [
      {
        "room_id": 1001,
        "building_name": "西一舍",
        "room_number": "405",
        "total_beds": 4,
        "occupied_beds": 2,
        "is_full": 0,
        "current_occupants": ["张三", "李四"] 
      }
    ]
  }
}
```

### 1.4 设置宿舍房间信息 (新增/修改)

#### 1.4.1 基本信息

  * **请求路径：** `/admin/dorm/rooms`
  * **请求方式：** `POST` / `PUT`
  * **接口描述：** 新增或修改宿舍房间信息 (管理 `t_dorm_room` 和 批量初始化 `t_bed`)。

#### 1.4.2 请求参数

  * **格式：** `application/json`
  * **参数说明：**

| 参数名 | 类型 | 是否必填 | 备注 |
| :--- | :--- | :--- | :--- |
| `room_id` | Long | PUT:是, POST:否 | 房间ID (修改时必填) |
| `building_id` | Integer | 是 | 关联宿舍楼ID |
| `room_number` | String | 是 | 房间编号 |
| `total_beds` | Integer | 是 | 床位总数 |
| `room_type` | String | 否 | 房间类型 |
| `has_private_bathroom` | Integer | 否 | 是否有独立卫生间 (1:是, 0:否) |

### 1.5 批量分配/调整宿舍 (管理员)

#### 1.5.1 基本信息

  * **请求路径：** `/admin/dorm/allocation/batch`
  * **请求方式：** `POST`
  * **接口描述：** 对应管理员“学生宿舍分配”，批量将学生分配到特定床位 (管理 `t_student_dorm`)。

#### 1.5.2 请求参数

  * **格式：** `application/json`
  * **参数说明：**

| 参数名 | 类型 | 是否必填 | 备注 |
| :--- | :--- | :--- | :--- |
| `allocations` | Array | 是 | 分配列表 |
| `allocations[].student_id` | Long | 是 | 学生ID |
| `allocations[].bed_id` | Long | 是 | 床位ID (`t_bed.bed_id`) |
| `allocations[].check_in_date` | Date | 是 | 入住日期 |

## 2\. 宿舍服务 (Student)

(此模块对应 `t_student_profile`, `t_dorm_preference`, `t_my_dorm`)

### 2.1 提交宿舍偏好问卷 (学生)

#### 2.1.1 基本信息

  * **请求路径：** `/student/dorm/preferences`
  * **请求方式：** `POST`
  * **接口描述：** 对应学生“提交问卷”。学生提交室友匹配偏好 (创建 `t_dorm_preference` 记录)。

#### 2.1.2 请求参数

  * **格式：** `application/json`
  * **参数说明：** (基于 `t_dorm_preference` 字段)

| 参数名 | 类型 | 是否必填 | 备注 |
| :--- | :--- | :--- | :--- |
| `wake_up_time` | Time | 是 | 期望起床时间 (如: "07:00:00") |
| `bedtime` | Time | 是 | 期望睡觉时间 (如: "23:00:00") |
| `study_habit_preference` | Integer | 是 | 学习偏好 |
| `hygiene_reference` | Integer | 是 | 卫生偏好 |
| `noise_tolerance` | Integer | 是 | 噪音容忍度 |
| `self_introduction` | String | 否 | 自我介绍 |

### 2.2 查询我的宿舍信息 (学生)

#### 2.2.1 基本信息

  * **请求路径：** `/student/my-dorm`
  * **请求方式：** `GET`
  * **接口描述：** 学生查询自己的宿舍、室友和床位信息。

#### 2.2.2 响应数据

  * **参数格式：** `application/json`
  * **响应数据样例：**

<!-- end list -->

```json
{
  "code": 1,
  "msg": "success",
  "data": {
    "room_id": 1001,
    "full_name": "西一舍405",
    "bed_number": "B1",
    "roommates": [
      {
        "student_id": 1002,
        "full_name": "李四",
        "phone_number": "138xxxxxxxx",
        "bed_number": "B2"
      }
    ],
    "matching_score": 0.95 
  }
}
```

### 2.3 生成宿舍分配建议 (管理员)

#### 2.3.1 基本信息

  * **请求路径：** `/admin/dorm/allocation/suggestions`
  * **请求方式：** `POST`
  * **接口描述：** 对应管理员“AI宿舍分配”，触发后端AI/算法基于问卷数据生成分配建议。

#### 2.3.2 请求参数

  * **格式：** `application/json`
  * **参数说明：** (触发参数)

| 参数名 | 类型 | 是否必填 | 备注 |
| :--- | :--- | :--- | :--- |
| `target_dorm_building_id` | Integer | 否 | 可选：限制在特定宿舍楼内进行分配 |
| `matching_strategy` | Integer | 是 | 匹配策略 (1:高相似度匹配, 2:随机分配) |

#### 2.3.3 响应数据

  * **参数格式：** `application/json`
  * **响应数据样例：**

<!-- end list -->

```json
{
  "code": 1,
  "msg": "success",
  "data": {
    "total_students_matched": 100,
    "suggestions_url": "https://.../allocation_report_20251109.csv",
    "preview": [
      {
        "student_id": 1001,
        "full_name": "张三",
        "suggested_room": "西一舍405",
        "suggested_bed_id": 5001,
        "average_match_score": 0.88
      }
    ]
  }
}
```

-----

## 3\. 交流平台模块 (Student / Teacher)

(此模块对应 `t_forum_category`, `t_forum_post`, `t_forum_comment`)

### 3.1 论坛板块列表查询

#### 3.1.1 基本信息

  * **请求路径：** `/forum/categories`
  * **请求方式：** `GET`
  * **接口描述：** 查询所有可用的论坛板块列表。

#### 3.1.2 响应数据

  * **参数格式：** `application/json`
  * **响应数据样例：**

<!-- end list -->

```json
{
  "code": 1,
  "msg": "success",
  "data": [
    {
      "category_id": 1,
      "category_name": "学术交流",
      "post_count": 120
    }
  ]
}
```

### 3.2 帖子列表查询

#### 3.2.1 基本信息

  * **请求路径：** `/forum/posts`
  * **请求方式：** `GET`
  * **接口描述：** 浏览帖子列表。

#### 3.2.2 请求参数

  * **格式：** `queryString`
  * **参数说明：**

| 参数名 | 类型 | 是否必填 | 备注 |
| :--- | :--- | :--- | :--- |
| `page` | Integer | 否 | 页码 (默认 1) |
| `category_id` | Integer | 否 | 按板块ID筛选 |
| `search_keyword` | String | 否 | 按标题或内容模糊搜索 |
| `is_top` | Integer | 否 | 仅查询置顶帖子 (1:是) |

### 3.3 发布新帖子 (发帖)

#### 3.3.1 基本信息

  * **请求路径：** `/forum/posts`
  * **请求方式：** `POST`
  * **接口描述：** 对应“发帖”功能 (创建 `t_forum_post` 记录)。

#### 3.3.2 请求参数

  * **格式：** `application/json`
  * **参数说明：**

| 参数名 | 类型 | 是否必填 | 备注 |
| :--- | :--- | :--- | :--- |
| `category_id` | Integer | 是 | 关联板块ID |
| `title` | String | 是 | 帖子标题 |
| `content` | String | 是 | 帖子内容 (支持 Markdown/富文本) |

### 3.4 查询帖子详情

#### 3.4.1 基本信息

  * **请求路径：** `/forum/posts/{post_id}`
  * **请求方式：** `GET`
  * **接口描述：** 查询单个帖子的详细信息，同时返回评论列表。

#### 3.4.2 响应数据

  * **参数格式：** `application/json`
  * **响应数据样例：**

<!-- end list -->

```json
{
  "code": 1,
  "msg": "success",
  "data": {
    "post": {
      "post_id": 1,
      "title": "如何学习C++",
      "author_name": "李老师",
      "created_at": "2025-11-08T10:00:00",
      "view_count": 50
    },
    "comments": [
      {
        "comment_id": 101,
        "author_name": "张三",
        "content": "建议先从B站教程开始...",
        "created_at": "2025-11-08T10:05:00"
      }
    ]
  }
}
```

### 3.5 删除帖子 (作者/管理员)

#### 3.5.1 基本信息

  * **请求路径：** `/forum/posts/{post_id}`
  * **请求方式：** `DELETE`
  * **接口描述：** 对应“删帖”功能。

### 3.6 发布评论 (评论)

#### 3.6.1 基本信息

  * **请求路径：** `/forum/posts/{post_id}/comments`
  * **请求方式：** `POST`
  * **接口描述：** 对应“评论”功能 (创建 `t_forum_comment` 记录)。

#### 3.6.2 请求参数

  * **格式：** 路径参数 + `application/json`
  * **参数说明：**

| 参数名 | 类型 | 是否必填 | 备注 |
| :--- | :--- | :--- | :--- |
| `post_id` | Long | 是 | (路径参数) 关联帖子ID |
| `content` | String | 是 | 评论内容 |
| `parent_comment_id` | Long | 否 | 如果是回复其他评论 (楼中楼) |

### 3.7 删除评论 (作者/管理员)

#### 3.7.1 基本信息

  * **请求路径：** `/forum/comments/{comment_id}`
  * **请求方式：** `DELETE`
  * **接口描述：** 删除评论。

### 3.8 置顶/取消置顶帖子 (管理员)

#### 3.8.1 基本信息

  * **请求路径：** `/admin/forum/posts/{post_id}/top`
  * **请求方式：** `PUT`
  * **接口描述：** 管理员设置帖子置顶状态。

#### 3.8.2 请求参数

  * **格式：** 路径参数 + `application/json`
  * **参数说明：**

| 参数名 | 类型 | 是否必填 | 备注 |
| :--- | :--- | :--- | :--- |
| `post_id` | Long | 是 | (路径参数) 帖子ID |
| `is_top` | Integer | 是 | 置顶状态 (1:置顶, 0:取消置顶) |

-----

