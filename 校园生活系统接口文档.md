
## 资源预约系统 (Resource Reservation System)

## 1\. 教室管理 (Admin)

(此模块对应 `t_building`, `t_classroom`，实现管理员对教室基础信息的设置和管理)

### 1.1 教学楼列表查询

#### 1.1.1 基本信息

  * **请求路径：** `/admin/buildings`
  * **请求方式：** `GET`
  * **接口描述：** 管理员查询教学楼列表。

#### 1.1.2 请求参数

  * **格式：** `queryString`
  * **参数说明：** (分页和状态查询)

| 参数名 | 类型 | 是否必填 | 备注 |
| :--- | :--- | :--- | :--- |
| `page` | Integer | 否 | 页码 (默认 1) |
| `pageSize` | Integer | 否 | 每页数量 (默认 10) |
| `building_name` | String | 否 | 按名称模糊查询 |
| `is_active` | Integer | 否 | 按状态查询 (1:启用, 0:停用) |

### 1.3 教室信息列表查询 (显示教室)

#### 1.3.1 基本信息

  * **请求路径：** `/admin/classrooms`
  * **请求方式：** `GET`
  * **接口描述：** 对应管理员“显示教室”功能，查询所有教室信息，支持按条件筛选。

#### 1.3.2 请求参数

  * **格式：** `queryString`
  * **参数说明：**

| 参数名 | 类型 | 是否必填 | 备注 |
| :--- | :--- | :--- | :--- |
| `page` | Integer | 否 | 页码 (默认 1) |
| `pageSize` | Integer | 否 | 每页数量 (默认 10) |
| `building_id` | Integer | 否 | 按所属教学楼ID筛选 |
| `room_number` | String | 否 | 按教室编号模糊查询 |
| `is_available` | Integer | 否 | 按是否停用筛选 (1:可用, 0:停用) |

  * **请求数据样例：** `/admin/classrooms?building_id=1&is_available=1`

#### 1.3.3 响应数据

  * **参数格式：** `application/json`
  * **响应数据样例：**

<!-- end list -->

```json
{
  "code": 1,
  "msg": "success",
  "data": {
    "total": 2,
    "rows": [
      {
        "room_id": 101,
        "full_name": "教三楼301",
        "building_name": "教三楼",
        "capacity": 120,
        "room_type": "阶梯教室",
        "equipment": ["投影仪", "音响"],
        "is_available": 1, 
        "set_by_admin": null
      }
    ]
  }
}
```

### 1.4 设置教室信息 (新增/修改) (管理员)

#### 1.4.1 基本信息

  * **请求路径：** `/admin/classrooms`
  * **请求方式：** `POST` / `PUT`
  * **接口描述：** 对应管理员“设置教室信息”功能。

#### 1.4.2 请求参数

  * **格式：** `application/json`
  * **参数说明：**

| 参数名 | 类型 | 是否必填 | 备注 |
| :--- | :--- | :--- | :--- |
| `room_id` | Long | POST:否, PUT:是 | 教室ID (修改时必填) |
| `building_id` | Integer | 是 | 关联教学楼ID |
| `room_number` | String | 是 | 教室编号 (如: "301") |
| `capacity` | Integer | 是 | 容纳人数 |
| `room_type` | String | 否 | 教室类型 |
| `equipment` | Array | 否 | 设备列表 (字符串数组) |

### 1.5 设置停用教室 (管理员)

#### 1.5.1 基本信息

  * **请求路径：** `/admin/classrooms/{room_id}/status`
  * **请求方式：** `PUT`
  * **接口描述：** 对应管理员“设置停用教室”功能。

#### 1.5.2 请求参数

  * **格式：** 路径参数 + `application/json`
  * **参数说明：**

| 参数名 | 类型 | 是否必填 | 备注 |
| :--- | :--- | :--- | :--- |
| `room_id` | Long | 是 | (路径参数) 教室ID |
| `is_available` | Integer | 是 | 教室状态 (1:可用, 0:停用/维修) |
| `reason` | String | 否 | 停用原因 (如果设置为0) |

  * **请求数据样例：**

<!-- end list -->

```json
{
    "is_available": 0,
    "reason": "设备检修，暂停使用至下周"
}
```

-----

## 2\. 教室预约 (Teacher / Student / Admin)

(此模块对应 `t_reservation_request` 表)

### 2.1 查询可用教室 (教师/学生)

#### 2.1.1 基本信息

  * **请求路径：** `/reservations/available-rooms`
  * **请求方式：** `GET`
  * **接口描述：** 对应“查询可用教室”。查询某一时间段内**未被预约**且**管理员未停用**的教室。

#### 2.1.2 请求参数

  * **格式：** `queryString`
  * **参数说明：**

| 参数名 | 类型 | 是否必填 | 备注 |
| :--- | :--- | :--- | :--- |
| `start_time` | Timestamp | 是 | 期望预约开始时间 |
| `end_time` | Timestamp | 是 | 期望预约结束时间 |
| `building_id` | Integer | 否 | 按教学楼筛选 |
| `capacity_min` | Integer | 否 | 最小容纳人数要求 |
| `equipment_required` | String | 否 | 必需设备关键词 (如: "投影仪") |

  * **请求数据样例：** `/reservations/available-rooms?start_time=2025-12-01T14:00:00&end_time=2025-12-01T16:00:00&capacity_min=50`

#### 2.1.3 响应数据

  * **参数格式：** `application/json`
  * **响应数据样例：**

<!-- end list -->

```json
{
  "code": 1,
  "msg": "success",
  "data": [
    {
      "room_id": 101,
      "full_name": "教三楼301",
      "capacity": 120,
      "room_type": "阶梯教室",
      "equipment": ["投影仪", "音响"]
    }
  ]
}
```

### 2.2 提交预约申请 (教师/学生)

#### 2.2.1 基本信息

  * **请求路径：** `/reservations`
  * **请求方式：** `POST`
  * **接口描述：** 对应“提交预约申请”，创建一个 `t_reservation_request` 记录。

#### 2.2.2 请求参数

  * **格式：** `application/json`
  * **参数说明：**

| 参数名 | 类型 | 是否必填 | 备注 |
| :--- | :--- | :--- | :--- |
| `room_id` | Long | 是 | 预约的教室ID |
| `start_time` | Timestamp | 是 | 预约开始时间 |
| `end_time` | Timestamp | 是 | 预约结束时间 |
| `purpose` | String | 是 | 预约用途 |
| `participants_count` | Integer | 否 | 参与人数 |

  * **请求数据样例：**

<!-- end list -->

```json
{
    "room_id": 101,
    "start_time": "2025-12-01T14:00:00",
    "end_time": "2025-12-01T16:00:00",
    "purpose": "小组讨论",
    "participants_count": 15
}
```

### 2.3 查看我的预约记录 (教师/学生)

#### 2.3.1 基本信息

  * **请求路径：** `/reservations/my`
  * **请求方式：** `GET`
  * **接口描述：** 对应“查看预约记录”。查询当前登录用户的所有预约记录。

#### 2.3.2 请求参数

  * **格式：** `queryString`
  * **参数说明：**

| 参数名 | 类型 | 是否必填 | 备注 |
| :--- | :--- | :--- | :--- |
| `page` | Integer | 否 | 页码 (默认 1) |
| `status` | Integer | 否 | 按状态筛选 (1:待审批, 2:已批准, 3:已驳回, 4:已撤回) |
| `date_from` | Date | 否 | 预约开始日期筛选 |

### 2.4 撤回预约申请 (教师/学生)

#### 2.4.1 基本信息

  * **请求路径：** `/reservations/{request_id}/withdraw`
  * **请求方式：** `PUT`
  * **接口描述：** 对应“撤回预约申请”。将 `status` 更新为 4 (已撤回)。

#### 2.4.2 请求参数

  * **格式：** 路径参数
  * **请求参数样例：** `/reservations/5/withdraw`

### 2.5 查询待审批的预约申请 (管理员)

#### 2.5.1 基本信息

  * **请求路径：** `/admin/reservations/pending`
  * **请求方式：** `GET`
  * **接口描述：** 对应管理员“审批预约申请”。查询所有待审批的申请 ( `status = 1` )。

#### 2.5.2 请求参数

  * **格式：** `queryString`
  * **参数说明：** (分页、筛选)

### 2.6 审批预约申请 (管理员)

#### 2.6.1 基本信息

  * **请求路径：** `/admin/reservations/{request_id}/approve`
  * **请求方式：** `PUT`
  * **接口描述：** 管理员处理预约申请。

#### 2.6.2 请求参数

  * **格式：** 路径参数 + `application/json`
  * **参数说明：**

| 参数名 | 类型 | 是否必填 | 备注 |
| :--- | :--- | :--- | :--- |
| `request_id` | Long | 是 | (路径参数) 申请ID |
| `status` | Integer | 是 | 审批结果 (2:已批准, 3:已驳回) |
| `approval_remarks` | String | 否 | 审批意见 |

  * **请求数据样例：**

<!-- end list -->

```json
{
    "status": 2,
    "approval_remarks": "同意预约"
}
```

-----

## 3\. 图书馆模块 - 书籍管理 (Admin)

(此模块对应 `t_book`, `t_tag`, `t_book_tag`, `t_book_policy`)

### 3.1 上传书籍 (管理员)

#### 3.1.1 基本信息

  * **请求路径：** `/admin/books`
  * **请求方式：** `POST`
  * **接口描述：** 对应管理员“上传书籍”功能 (创建 `t_book` 记录)。

#### 3.1.2 请求参数

  * **格式：** `application/json`
  * **参数说明：**

| 参数名 | 类型 | 是否必填 | 备注 |
| :--- | :--- | :--- | :--- |
| `isbn` | String | 是 | ISBN编号 (唯一) |
| `title` | String | 是 | 书籍标题 |
| `author` | String | 是 | 作者 |
| `publisher` | String | 否 | 出版社 |
| `publication_year` | Integer | 否 | 出版年份 |
| `total_copies` | Integer | 是 | 总份数 |
| `tags` | Array | 否 | 标签名称字符串数组 (用于批量添加 `t_tag` 并关联 `t_book_tag`) |

### 3.2 图书列表查询

#### 3.2.1 基本信息

  * **请求路径：** `/books`
  * **请求方式：** `GET`
  * **接口描述：** 查询书籍列表 (管理员和学生均可用，学生端仅展示在架书籍)。

#### 3.2.2 请求参数

  * **格式：** `queryString`
  * **参数说明：**

| 参数名 | 类型 | 是否必填 | 备注 |
| :--- | :--- | :--- | :--- |
| `page` | Integer | 否 | 页码 |
| `title` | String | 否 | 按书名模糊查询 |
| `author` | String | 否 | 按作者模糊查询 |
| `tag_name` | String | 否 | 按标签名称筛选 |
| `is_admin_view` | Boolean | 否 | 仅管理员查询时传 true，用于显示全部书籍和状态。 |

### 3.3 添加书籍标签 (管理员/学生)

#### 3.3.1 基本信息

  * **请求路径：** `/books/{book_id}/tags`
  * **请求方式：** `POST`
  * **接口描述：** 对应“添加书籍标签”。在 `t_book_tag` 中创建关联记录，如果标签不存在则先创建 `t_tag`。

#### 3.3.2 请求参数

  * **格式：** 路径参数 + `application/json`
  * **参数说明：**

| 参数名 | 类型 | 是否必填 | 备注 |
| :--- | :--- | :--- | :--- |
| `book_id` | Long | 是 | (路径参数) 书籍ID |
| `tag_name` | String | 是 | 标签名称 |

### 3.4 借阅策略管理 (管理员)

#### 3.4.1 设置借书时长 (新增/修改)

  * **请求路径：** `/admin/book-policies`
  * **请求方式：** `POST` / `PUT`
  * **接口描述：** 对应管理员“设置借书时长”功能 (管理 `t_book_policy`)。

#### 3.4.2 请求参数

| 参数名 | 类型 | 是否必填 | 备注 |
| :--- | :--- | :--- | :--- |
| `policy_id` | Integer | PUT:是, POST:否 | 策略ID |
| `policy_name` | String | 是 | 策略名称 |
| `max_duration_days` | Integer | 是 | 最大借阅时长 (天) |
| `max_borrow_count` | Integer | 是 | 最大可借阅数量 |
| `user_type_scope` | Integer | 否 | 适用用户类型 (1:学生, 2:教师) |

-----

## 4\. 图书馆模块 - 借阅服务 (Student / Admin)

(此模块对应 `t_borrow_record`)

### 4.1 借阅书籍 (学生)

#### 4.1.1 基本信息

  * **请求路径：** `/student/borrow`
  * **请求方式：** `POST`
  * **接口描述：** 对应学生“借阅书籍”功能 (创建 `t_borrow_record` 记录，并减少 `t_book` 的库存)。

#### 4.1.2 请求参数

  * **格式：** `application/json`
  * **参数说明：**

| 参数名 | 类型 | 是否必填 | 备注 |
| :--- | :--- | :--- | :--- |
| `book_id` | Long | 是 | 借阅的书籍ID |

### 4.2 归还书籍 (学生/管理员)

#### 4.2.1 基本信息

  * **请求路径：** `/borrow-records/{record_id}/return`
  * **请求方式：** `PUT`
  * **接口描述：** 记录归还操作 (更新 `t_borrow_record` 的 `return_date`)。

#### 4.2.2 请求参数

  * **格式：** 路径参数

### 4.3 我的借阅记录 (学生)

#### 4.3.1 基本信息

  * **请求路径：** `/student/borrow-records`
  * **请求方式：** `GET`
  * **接口描述：** 学生查询自己的借阅历史和当前借阅。

### 4.4 接收推送偏好书籍 (学生)

#### 4.4.1 基本信息

  * **请求路径：** `/student/book-recommendations`
  * **请求方式：** `GET`
  * **接口描述：** 对应“接收推送偏好书籍”。基于学生的借阅历史、标签偏好等，推送推荐书籍。

#### 4.4.2 响应数据

  * **参数格式：** `application/json`
  * **响应数据样例：**

<!-- end list -->

```json
{
  "code": 1,
  "msg": "success",
  "data": [
    {
      "book_id": 201,
      "title": "推荐书籍A",
      "reason": "您最近借阅了相关标签的书籍"
    }
  ]
}
```
